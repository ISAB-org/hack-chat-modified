var markdownOptions={html:!1,xhtmlOut:!1,breaks:!0,langPrefix:"",linkify:!0,linkTarget:'_blank" rel="noreferrer',typographer:!0,quotes:"\"\"''",doHighlight:!0,highlight:function(e,t){if(!markdownOptions.doHighlight||!window.hljs)return"";if(t&&hljs.getLanguage(t))try{return hljs.highlight(t,e).value}catch(e){}try{return hljs.highlightAuto(e).value}catch(e){}return""}},md=new Remarkable("full",markdownOptions),allowImages=!1,imgHostWhitelist=["i.imgur.com","imgur.com"];function getDomain(e){var t=document.createElement("a");return t.href=e,t.hostname}function isWhiteListed(e){return-1!==imgHostWhitelist.indexOf(getDomain(e))}function verifyLink(e){var t=Remarkable.utils.escapeHtml(Remarkable.utils.replaceEntities(e.href));return t===e.innerHTML||confirm("Warning, please verify this is where you want to go: "+t)}md.renderer.rules.image=function(e,t,n){var i=Remarkable.utils.escapeHtml(e[t].src);if(isWhiteListed(i)&&allowImages){var a=' src="'+Remarkable.utils.escapeHtml(e[t].src)+'"',o=e[t].title?' title="'+Remarkable.utils.escapeHtml(Remarkable.utils.replaceEntities(e[t].title))+'"':"",r=' alt="'+(e[t].alt?Remarkable.utils.escapeHtml(Remarkable.utils.replaceEntities(Remarkable.utils.unescapeMd(e[t].alt))):"")+'"',s=n.xhtmlOut?" /":"";return'<a href="'+i+'" target="_blank" rel="noreferrer"><img'+(isAtBottom()?' onload="window.scrollTo(0, document.body.scrollHeight)"':"")+a+r+o+s+"></a>"}return'<a href="'+i+'" target="_blank" rel="noreferrer">'+Remarkable.utils.escapeHtml(Remarkable.utils.replaceEntities(i))+"</a>"},md.renderer.rules.link_open=function(e,t,n){var i=e[t].title?' title="'+Remarkable.utils.escapeHtml(Remarkable.utils.replaceEntities(e[t].title))+'"':"",a=n.linkTarget?' target="'+n.linkTarget+'"':"";return'<a rel="noreferrer" onclick="return verifyLink(this)" href="'+Remarkable.utils.escapeHtml(e[t].href)+'"'+i+a+">"},md.renderer.rules.text=function(e,t){return e[t].content=Remarkable.utils.escapeHtml(e[t].content),-1!==e[t].content.indexOf("?")&&(e[t].content=e[t].content.replace(/(^|\s)(\?)\S+?(?=[,.!?:)]?\s|$)/gm,(function(e){var t=Remarkable.utils.escapeHtml(Remarkable.utils.replaceEntities(e.trim())),n="";return"?"!==e[0]&&(n=e[0]),n+'<a href="'+t+'" target="_blank">'+t+"</a>"}))),e[t].content},md.use(remarkableKatex);var ws,verifyNickname=function(e){return/^[a-zA-Z0-9_]{1,24}$/.test(e)},frontpage=["                            _           _         _       _   ","                           | |_ ___ ___| |_   ___| |_ ___| |_ ","                           |   |_ ||  _| '_| |  _|   |_ ||  _|","                           |_|_|__/|___|_,_|.|___|_|_|__/|_|  ","","","Welcome to hack.chat, a minimal, distraction-free chat application.","Channels are created, joined and shared with the url, create your own channel by changing the text after the question mark.","If you wanted your channel name to be 'your-channel': https://hack.chat/?your-channel","There are no channel lists, so a secret channel name can be used for private discussions.","","Here are some pre-made channels you can join:","?lounge ?meta","?math ?physics ?chemistry","?technology ?programming","?games ?banana","And here's a random one generated just for you: ?"+Math.random().toString(36).substr(2,8),"","Formatting:","Whitespace is preserved, so source code can be pasted verbatim.","Surround LaTeX with a dollar sign for inline style $\\zeta(2) = \\pi^2/6$, and two dollars for display. $$\\int_0^1 \\int_0^1 \\frac{1}{1-xy} dx dy = \\frac{\\pi^2}{6}$$","For syntax highlight, wrap the code like: ```<language> <the code>``` where <language> is any known programming language.","","Current Github: https://github.com/hack-chat","Legacy GitHub: https://github.com/AndrewBelt/hack.chat","","Bots, Android clients, desktop clients, browser extensions, docker images, programming libraries, server modules and more:","https://github.com/hack-chat/3rd-party-software-list","","Server and web client released under the WTFPL and MIT open source license.","No message history is retained on the hack.chat server."].join("\n");function $(e){return document.querySelector(e)}function localStorageGet(e){try{return window.localStorage[e]}catch(e){}}function localStorageSet(e,t){try{window.localStorage[e]=t}catch(e){}}var myNick=localStorageGet("my-nick")||"",myChannel=window.location.search.replace(/^\?/,""),lastSent=[""],lastSentPos=0,notifySwitch=document.getElementById("notify-switch"),notifySetting=localStorageGet("notify-api"),notifyPermissionExplained=0;function RequestNotifyPermission(){try{var e=Notification.requestPermission();e&&e.then((function(e){return console.log("Hack.Chat notification permission: "+e),"granted"===e?(0===notifyPermissionExplained&&(pushMessage({cmd:"chat",nick:"*",text:"Notifications permission granted.",time:null}),notifyPermissionExplained=1),!1):(0===notifyPermissionExplained&&(pushMessage({cmd:"chat",nick:"*",text:"Notifications permission denied, you won't be notified if someone @mentions you.",time:null}),notifyPermissionExplained=-1),!0)}))}catch(e){return pushMessage({cmd:"chat",nick:"*",text:"Unable to create a notification.",time:null}),console.error("An error occured trying to request notification permissions. This browser might not support desktop notifications.\nDetails:"),console.error(e),!1}}notifySwitch.addEventListener("change",(e=>{e.target.checked&&RequestNotifyPermission(),localStorageSet("notify-api",notifySwitch.checked)})),null===notifySetting&&(localStorageSet("notify-api","false"),notifySwitch.checked=!1),"true"===notifySetting||!0===notifySetting?notifySwitch.checked=!0:"false"!==notifySetting&&!1!==notifySetting||(notifySwitch.checked=!1);var soundSwitch=document.getElementById("sound-switch");function spawnNotification(e,t){if("Notification"in window)if("granted"===Notification.permission){var n={body:t,icon:"/favicon-96x96.png"};new Notification(e,n)}else"denied"!==Notification.permission?RequestNotifyPermission()&&(n={body:t,icon:"/favicon-96x96.png"},new Notification(e,n)):Notification.permission;else console.error("This browser does not support desktop notification")}function notify(e){if(notifySwitch.checked&&spawnNotification("?"+myChannel+"  â€”  "+e.nick,e.text),soundSwitch.checked){var t=document.getElementById("notify-sound").play();t&&t.catch((function(e){console.error("Problem playing sound:\n"+e)}))}}function join(e){if("hack.chat"==document.domain)ws=new WebSocket("wss://hack.chat/chat-ws");else{var t="https:"===location.protocol?"wss:":"ws:";ws=new WebSocket(t+"//"+document.domain+":6060")}var n=!1;ws.onopen=function(){var t=!0;if(!n)if(location.hash)myNick=location.hash.substr(1);else{var i=prompt("Nickname:",myNick);null!==i?myNick=i:t=!1}myNick&&t&&(localStorageSet("my-nick",myNick),send({cmd:"join",channel:e,nick:myNick})),n=!0},ws.onclose=function(){n&&pushMessage({nick:"!",text:"Server disconnected. Attempting to reconnect. . ."}),window.setTimeout((function(){join(e)}),2e3)},ws.onmessage=function(e){var t=JSON.parse(e.data),n=t.cmd;COMMANDS[n].call(null,t)}}notifySetting=localStorageGet("notify-sound"),soundSwitch.addEventListener("change",(e=>{localStorageSet("notify-sound",soundSwitch.checked)})),null===notifySetting&&(localStorageSet("notify-sound","false"),soundSwitch.checked=!1),"true"===notifySetting||!0===notifySetting?soundSwitch.checked=!0:"false"!==notifySetting&&!1!==notifySetting||(soundSwitch.checked=!1);var COMMANDS={chat:function(e){ignoredUsers.indexOf(e.nick)>=0||pushMessage(e)},info:function(e){e.nick="*",pushMessage(e)},warn:function(e){e.nick="!",pushMessage(e)},onlineSet:function(e){var t=e.nicks;usersClear(),t.forEach((function(e){userAdd(e)})),pushMessage({nick:"*",text:"Users online: "+t.join(", ")})},onlineAdd:function(e){var t=e.nick;userAdd(t),$("#joined-left").checked&&pushMessage({nick:"*",text:t+" joined"})},onlineRemove:function(e){var t=e.nick;userRemove(t),$("#joined-left").checked&&pushMessage({nick:"*",text:t+" left"})}};function pushMessage(e){var t=document.createElement("div");"string"==typeof myNick&&(e.text.match(new RegExp("@"+myNick.split("#")[0]+"\\b","gi"))||("whisper"===e.type||"invite"===e.type)&&e.from)&&notify(e),t.classList.add("message"),verifyNickname(myNick)&&e.nick==myNick?t.classList.add("me"):"!"==e.nick?t.classList.add("warn"):"*"==e.nick?t.classList.add("info"):e.admin?t.classList.add("admin"):e.mod&&t.classList.add("mod");var n=document.createElement("span");if(n.classList.add("nick"),t.appendChild(n),e.trip){var i=document.createElement("span");i.textContent=e.trip+" ",i.classList.add("trip"),n.appendChild(i)}if(e.nick){var a=document.createElement("a");a.textContent=e.nick,a.onclick=function(){insertAtCursor("@"+e.nick+" "),$("#chatinput").focus()};var o=new Date(e.time||Date.now());a.title=o.toLocaleString(),n.appendChild(a)}var r=document.createElement("p");r.classList.add("text"),r.innerHTML=md.render(e.text),t.appendChild(r);var s=isAtBottom();$("#messages").appendChild(t),s&&window.scrollTo(0,document.body.scrollHeight),unread+=1,updateTitle()}function insertAtCursor(e){var t=$("#chatinput"),n=t.selectionStart||0,i=t.value.substr(0,n),a=t.value.substr(n);i+=e,t.value=i+a,t.selectionStart=t.selectionEnd=i.length,updateInputSize()}function send(e){ws&&ws.readyState==ws.OPEN&&ws.send(JSON.stringify(e))}var windowActive=!0,unread=0;function isAtBottom(){return window.innerHeight+window.scrollY>=document.body.scrollHeight-1}function updateTitle(){var e;windowActive&&isAtBottom()&&(unread=0),e=myChannel?"?"+myChannel:"hack.chat",unread>0&&(e="("+unread+") "+e),document.title=e}function updateInputSize(){var e=isAtBottom(),t=$("#chatinput");t.style.height=0,t.style.height=t.scrollHeight+"px",document.body.style.marginBottom=$("#footer").offsetHeight+"px",e&&window.scrollTo(0,document.body.scrollHeight)}window.onfocus=function(){windowActive=!0,updateTitle()},window.onblur=function(){windowActive=!1},window.onscroll=function(){isAtBottom()&&updateTitle()},$("#footer").onclick=function(){$("#chatinput").focus()},$("#chatinput").onkeydown=function(e){if(13!=e.keyCode||e.shiftKey){if(38==e.keyCode)0===e.target.selectionStart&&lastSentPos<lastSent.length-1&&(e.preventDefault(),0==lastSentPos&&(lastSent[0]=e.target.value),lastSentPos+=1,e.target.value=lastSent[lastSentPos],e.target.selectionStart=e.target.selectionEnd=e.target.value.length,updateInputSize());else if(40==e.keyCode)e.target.selectionStart===e.target.value.length&&lastSentPos>0&&(e.preventDefault(),lastSentPos-=1,e.target.value=lastSent[lastSentPos],e.target.selectionStart=e.target.selectionEnd=0,updateInputSize());else if(27==e.keyCode)e.preventDefault(),e.target.value="",lastSent[lastSentPos=0]="",updateInputSize();else if(9==e.keyCode){if(e.ctrlKey)return;e.preventDefault();var t=e.target.selectionStart||0,n=(r=e.target.value).lastIndexOf("@",t),i=!1;if(n>=0){var a=r.substring(n+1,t).toLowerCase(),o=onlineUsers.filter((function(e){return 0==e.toLowerCase().indexOf(a)}));o.length>0&&(i=!0,1==o.length&&insertAtCursor(o[0].substr(a.length)+" "))}i||insertAtCursor("\t")}}else if(e.preventDefault(),""!=e.target.value){var r=e.target.value;e.target.value="",send({cmd:"chat",text:r}),lastSent[0]=r,lastSent.unshift(""),lastSentPos=0,updateInputSize()}},$("#chatinput").oninput=function(){updateInputSize()},updateInputSize(),$("#sidebar").onmouseenter=$("#sidebar").ontouchstart=function(e){$("#sidebar-content").classList.remove("hidden"),$("#sidebar").classList.add("expand"),e.stopPropagation()},$("#sidebar").onmouseleave=document.ontouchstart=function(e){var t=e.toElement||e.relatedTarget;try{if(t.parentNode==this||t==this)return}catch(t){return}$("#pin-sidebar").checked||($("#sidebar-content").classList.add("hidden"),$("#sidebar").classList.remove("expand"))},$("#clear-messages").onclick=function(){$("#messages").innerHTML=""},"true"==localStorageGet("pin-sidebar")&&($("#pin-sidebar").checked=!0,$("#sidebar-content").classList.remove("hidden")),"false"==localStorageGet("joined-left")&&($("#joined-left").checked=!1),"false"==localStorageGet("parse-latex")&&($("#parse-latex").checked=!1,md.inline.ruler.disable(["katex"]),md.block.ruler.disable(["katex"])),$("#pin-sidebar").onchange=function(e){localStorageSet("pin-sidebar",!!e.target.checked)},$("#joined-left").onchange=function(e){localStorageSet("joined-left",!!e.target.checked)},$("#parse-latex").onchange=function(e){var t=!!e.target.checked;localStorageSet("parse-latex",t),t?(md.inline.ruler.enable(["katex"]),md.block.ruler.enable(["katex"])):(md.inline.ruler.disable(["katex"]),md.block.ruler.disable(["katex"]))},"false"==localStorageGet("syntax-highlight")&&($("#syntax-highlight").checked=!1,markdownOptions.doHighlight=!1),$("#syntax-highlight").onchange=function(e){var t=!!e.target.checked;localStorageSet("syntax-highlight",t),markdownOptions.doHighlight=t},"false"==localStorageGet("allow-imgur")&&($("#allow-imgur").checked=!1,allowImages=!1),$("#allow-imgur").onchange=function(e){var t=!!e.target.checked;localStorageSet("allow-imgur",t),allowImages=t};var onlineUsers=[],ignoredUsers=[];function userAdd(e){var t=document.createElement("a");t.textContent=e,t.onclick=function(t){userInvite(e)};var n=document.createElement("li");n.appendChild(t),$("#users").appendChild(n),onlineUsers.push(e)}function userRemove(e){for(var t=$("#users"),n=t.children,i=0;i<n.length;i++){var a=n[i];a.textContent==e&&t.removeChild(a)}var o=onlineUsers.indexOf(e);o>=0&&onlineUsers.splice(o,1)}function usersClear(){for(var e=$("#users");e.firstChild;)e.removeChild(e.firstChild);onlineUsers.length=0}function userInvite(e){send({cmd:"invite",nick:e})}function userIgnore(e){ignoredUsers.push(e)}var schemes=["android","android-white","atelier-dune","atelier-forest","atelier-heath","atelier-lakeside","atelier-seaside","banana","bright","bubblegum","chalk","default","eighties","fresh-green","greenscreen","hacker","maniac","mariana","military","mocha","monokai","nese","ocean","omega","pop","railscasts","solarized","tomorrow"],highlights=["agate","androidstudio","atom-one-dark","darcula","github","rainbow","tomorrow","xcode","zenburn"],currentScheme="atelier-dune",currentHighlight="darcula";function setScheme(e){currentScheme=e,$("#scheme-link").href="schemes/"+e+".css",localStorageSet("scheme",e)}function setHighlight(e){currentHighlight=e,$("#highlight-link").href="vendor/hljs/styles/"+e+".min.css",localStorageSet("highlight",e)}schemes.forEach((function(e){var t=document.createElement("option");t.textContent=e,t.value=e,$("#scheme-selector").appendChild(t)})),highlights.forEach((function(e){var t=document.createElement("option");t.textContent=e,t.value=e,$("#highlight-selector").appendChild(t)})),$("#scheme-selector").onchange=function(e){setScheme(e.target.value)},$("#highlight-selector").onchange=function(e){setHighlight(e.target.value)},localStorageGet("scheme")&&setScheme(localStorageGet("scheme")),localStorageGet("highlight")&&setHighlight(localStorageGet("highlight")),$("#scheme-selector").value=currentScheme,$("#highlight-selector").value=currentHighlight,""==myChannel?(pushMessage({text:frontpage}),$("#footer").classList.add("hidden"),$("#sidebar").classList.add("hidden")):join(myChannel);